<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MAPA INTERACTIVO · SIEI</title>

<style>
  :root{
    --bg:#0f172a;
    --ink:#ffffff;
    --muted:#cbd5e1;
    --line:rgba(255,255,255,.14);

    --green:#22c55e;

    --shadow: 0 14px 40px rgba(0,0,0,.45);
    --radius: 18px;
  }

  *{ box-sizing:border-box; }

  body{
    margin:0;
    font-family: Arial, Helvetica, sans-serif;
    background: radial-gradient(1200px 800px at 10% 10%, #1a2a6a 0%, var(--bg) 55%) fixed;
    color: var(--ink);
  }

  .app{
    max-width: 1200px;
    margin: 0 auto;
    padding: 14px;
  }

  /* RESPONSIVE LAYOUT */
  .layout{
    display:grid;
    grid-template-columns: 380px 1fr;
    gap: 14px;
    align-items: start;
  }
  @media (max-width: 920px){
    .layout{
      grid-template-columns: 1fr;
    }
  }

  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
    border: 1px solid var(--line);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow:hidden;
  }

  /* LEFT: INSTRUCTIONS */
  .left{
    padding: 16px;
  }
  .chip{
    display:inline-block;
    padding: 6px 10px;
    border-radius: 999px;
    background: rgba(255,255,255,.10);
    border: 1px solid rgba(255,255,255,.12);
    color: var(--muted);
    font-weight: 900;
    font-size: 12px;
    letter-spacing: .4px;
    text-transform: uppercase;
    margin-bottom: 10px;
  }

  .title{
    margin: 0 0 10px;
    font-size: 18px;
    font-weight: 900;
    letter-spacing: .4px;
    text-transform: uppercase;
  }

  #instrText{
    margin: 0 0 14px;
    font-size: 18px;
    line-height: 1.35;
    font-weight: 900;
    letter-spacing: .3px;
    text-transform: uppercase; /* TODO EN MAYÚSCULAS */
    white-space: pre-line;      /* respeta saltos */
  }

  .note{
    margin: 0 0 12px;
    color: var(--muted);
    font-size: 13px;
    line-height: 1.35;
    text-transform: uppercase;
    letter-spacing: .2px;
  }

  .btnRow{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    justify-content:flex-end;
  }

  button{
    border:0;
    border-radius: 14px;
    padding: 12px 14px;
    font-weight: 900;
    cursor:pointer;
    background: rgba(255,255,255,.10);
    color: var(--ink);
    text-transform: uppercase;
    letter-spacing: .3px;
  }
  button:hover{ background: rgba(255,255,255,.14); }
  button.primary{
    background: rgba(34,197,94,.88);
    color:#061f12;
  }
  button.primary:hover{ background: rgba(34,197,94,.98); }
  button[disabled]{
    opacity:.45;
    cursor:not-allowed;
  }

  /* RIGHT: MAP */
  .right{
    padding: 14px;
  }
  .mapWrap{
    position:relative;
    width:100%;
  }
  #mapa{
    width:100%;
    height:auto;
    display:block;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.10);
  }

  /* HOTSPOTS */
  .zona{
    position:absolute;
    border-radius: 12px;
    background: rgba(255,255,255,0.00); /* invisible */
    pointer-events: none; /* se activa por JS */
  }

  /* SOLO la CLASE se marca visualmente */
  .zona.active{
    pointer-events: auto;
    cursor:pointer;
    outline: 4px solid var(--green);
    outline-offset: 2px;
    box-shadow: 0 0 0 6px rgba(34,197,94,.25);
    animation: pulse 1.1s infinite;
  }

  @keyframes pulse{
    0%{ transform: scale(1); }
    50%{ transform: scale(1.01); }
    100%{ transform: scale(1); }
  }
</style>
</head>

<body>
  <div class="app">
    <div class="layout">
      <!-- LEFT PANEL -->
      <section class="card left" aria-label="Instrucciones">
        <div class="chip" id="chip">PASO 1</div>
        

        <p id="instrText"></p>
        <p class="note" id="note">PULSA ▶ PLAY PARA ESCUCHAR.</p>

        <div class="btnRow">
          <button id="btnPlay">▶ PLAY</button>
          <button class="primary" id="btnContinue" style="display:none;">CONTINUAR</button>
        </div>
      </section>

      <!-- RIGHT PANEL -->
      <section class="card right" aria-label="Mapa">
        <div class="mapWrap" id="contenedor">
          <!-- PON AQUÍ TU IMAGEN LIMPIA -->
          <img src="mapa.jpg" id="mapa" alt="Mapa del instituto" />

          <!-- 1) PISTAS (NO TOCAR) -->
          <div class="zona" id="zPistas" data-lugar="pistas"
               style="left:6%;top:18%;width:42%;height:32%"></div>

          <!-- 2) ENTRADA (NO TOCAR) -->
          <div class="zona" id="zEntrada" data-lugar="entrada"
               style="left:45%;top:66%;width:10%;height:22%"></div>

          <!-- 3) CLASE (CORREGIDA) -->
          <div class="zona" id="zClase" data-lugar="clase"
               style="left:53.4%;top:69.6%;width:6.5%;height:11.7%"></div>
        </div>
      </section>
    </div>
  </div>

<script>
(() => {
  // -----------------------
  // TTS
  // -----------------------
  function speak(text){
    try{
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "es-ES";
      u.rate = 0.92;
      u.pitch = 1.0;
      speechSynthesis.speak(u);
    }catch(e){}
  }

  // -----------------------
  // DOM
  // -----------------------
  const chipEl = document.getElementById("chip");
  const instrTextEl = document.getElementById("instrText");
  const noteEl = document.getElementById("note");
  const btnPlay = document.getElementById("btnPlay");
  const btnContinue = document.getElementById("btnContinue");

  const zClase = document.getElementById("zClase");
  const zEntrada = document.getElementById("zEntrada");
  const zPistas = document.getElementById("zPistas");

  // -----------------------
  // HOTSPOT ACTIVATION
  // -----------------------
  function clearZones(){
    [zClase, zEntrada, zPistas].forEach(z => {
      z.classList.remove("active");
      z.style.pointerEvents = "none";
    });
  }

  // CLASE: visible (marcada). ENTRADA/PISTAS: clicables pero invisibles.
  function setActiveZone(name){
    clearZones();

    if(name === "clase"){
      zClase.classList.add("active");          // visible
      zClase.style.pointerEvents = "auto";
    }
    else if(name === "entrada"){
      zEntrada.style.pointerEvents = "auto";   // invisible pero clicable
    }
    else if(name === "pistas"){
      zPistas.style.pointerEvents = "auto";    // invisible pero clicable
    }
  }

  // -----------------------
  // SCENES
  // type:
  // - "action": pide clic correcto (SIN CONTINUAR)
  // - "praise": felicitación (CON CONTINUAR)
  // -----------------------
  const scenes = [
    {
      chip: "PASO 1",
      type: "action",
      active: "clase",
      text:
`ESTO ES TU INSTITUTO VISTO DESDE EL CIELO.
TU CLASE ESTÁ MARCADA CON UN CUADRADO VERDE.
¿PUEDES HACER CLICK SOBRE EL CUADRADO DONDE ESTÁ TU CLASE?`
    },
    {
      chip: "BIEN",
      type: "praise",
      active: null,
      text: "¡FELICIDADES! LO HAS HECHO BIEN. ESO ERA TU CLASE."
    },
    {
      chip: "PASO 2",
      type: "action",
      active: "entrada",
      text:
`AHORA VAMOS A SALIR DEL INSTITUTO.
LA ENTRADA PRINCIPAL ESTÁ EN EL MAPA.
¿PUEDES HACER CLICK EN LA ENTRADA?`
    },
    {
      chip: "BIEN",
      type: "praise",
      active: null,
      text: "¡FELICIDADES! LO HAS HECHO BIEN. POR AQUÍ ENTRAS CADA DÍA."
    },
    {
      chip: "PASO 3",
      type: "action",
      active: "pistas",
      text:
`AHORA BUSCA LAS PISTAS DEPORTIVAS.
SON UN LUGAR GRANDE PARA HACER DEPORTE.
¿PUEDES HACER CLICK EN LAS PISTAS?`
    },
    {
      chip: "FINAL",
      type: "praise",
      active: null,
      text:
`¡FELICIDADES! LO HAS HECHO BIEN.
HAS ENCONTRADO CLASE, ENTRADA Y PISTAS.
ESTO ES UN MAPA: TE AYUDA A ORIENTARTE VISTO DESDE ARRIBA.`
    }
  ];

  let idx = 0;
  let currentText = scenes[0].text;

  function render(){
    const s = scenes[idx];
    chipEl.textContent = s.chip;
    instrTextEl.textContent = s.text.toUpperCase();
    currentText = s.text.toUpperCase();

    if(s.type === "action"){
      btnContinue.style.display = "none";
      noteEl.textContent = "PULSA ▶ PLAY PARA ESCUCHAR. LUEGO HAZ CLICK EN EL MAPA.";
      setActiveZone(s.active);
    } else {
      btnContinue.style.display = "inline-block";
      noteEl.textContent = "PULSA ▶ PLAY PARA ESCUCHAR. LUEGO PULSA CONTINUAR.";
      setActiveZone(null);
      clearZones();
    }
  }

  function next(){
    idx = Math.min(idx + 1, scenes.length - 1);
    render();
  }

  function restart(){
    idx = 0;
    render();
  }

  // -----------------------
  // Buttons
  // -----------------------
  btnPlay.addEventListener("click", () => speak(currentText));

  btnContinue.addEventListener("click", () => {
    // En el FINAL, reinicia (si quieres que termine, te lo cambio)
    if(scenes[idx].chip === "FINAL"){
      restart();
      return;
    }
    next();
  });

  // -----------------------
  // Click handling (solo en action)
  // -----------------------
  function handleCorrectClick(name){
    const s = scenes[idx];
    if(s.type !== "action") return;
    if(s.active !== name) return; // (las otras ni son clicables)
    next(); // pasa a felicitación
  }

  zClase.addEventListener("click", () => handleCorrectClick("clase"));
  zEntrada.addEventListener("click", () => handleCorrectClick("entrada"));
  zPistas.addEventListener("click", () => handleCorrectClick("pistas"));

  // START
  render();
})();
</script>
</body>
</html>
